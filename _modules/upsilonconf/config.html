<!DOCTYPE html>

<html lang="en" data-content_root="../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>upsilonconf.config &#8212; UpsilonConf 0.7.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=d1102ebc" />
    <link rel="stylesheet" type="text/css" href="../../_static/basic.css?v=c058f7c8" />
    <link rel="stylesheet" type="text/css" href="../../_static/alabaster.css?v=7e62b5ef" />
    <script src="../../_static/documentation_options.js?v=fe7df9b0"></script>
    <script src="../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="author" title="About these documents" href="../../about.html" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for upsilonconf.config</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">keyword</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">from</span> <span class="nn">abc</span> <span class="kn">import</span> <span class="n">ABC</span><span class="p">,</span> <span class="n">abstractmethod</span>
<span class="kn">from</span> <span class="nn">argparse</span> <span class="kn">import</span> <span class="n">ArgumentParser</span><span class="p">,</span> <span class="n">Namespace</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">TypeVar</span><span class="p">,</span>
    <span class="n">MutableMapping</span><span class="p">,</span>
    <span class="n">Any</span><span class="p">,</span>
    <span class="n">Iterator</span><span class="p">,</span>
    <span class="n">Iterable</span><span class="p">,</span>
    <span class="n">Union</span><span class="p">,</span>
    <span class="n">Tuple</span><span class="p">,</span>
    <span class="n">Mapping</span><span class="p">,</span>
    <span class="n">Dict</span><span class="p">,</span>
    <span class="n">Pattern</span><span class="p">,</span>
    <span class="n">overload</span><span class="p">,</span>
    <span class="n">Type</span><span class="p">,</span>
    <span class="n">Optional</span><span class="p">,</span>
    <span class="n">ItemsView</span><span class="p">,</span>
    <span class="n">KeysView</span><span class="p">,</span>
    <span class="n">ValuesView</span><span class="p">,</span>
    <span class="n">Collection</span><span class="p">,</span>
    <span class="n">Hashable</span><span class="p">,</span>
    <span class="n">Sequence</span><span class="p">,</span>
    <span class="n">Literal</span><span class="p">,</span>
<span class="p">)</span>

<span class="kn">from</span> <span class="nn">.io</span> <span class="kn">import</span> <span class="n">ConfigIO</span><span class="p">,</span> <span class="n">ConfigParser</span><span class="p">,</span> <span class="n">get_default_io</span>

<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;ConfigurationBase&quot;</span><span class="p">,</span>
    <span class="s2">&quot;PlainConfiguration&quot;</span><span class="p">,</span>
    <span class="s2">&quot;FrozenConfiguration&quot;</span><span class="p">,</span>
    <span class="s2">&quot;CarefulConfiguration&quot;</span><span class="p">,</span>
    <span class="s2">&quot;InvalidKeyError&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Configuration&quot;</span><span class="p">,</span>
<span class="p">]</span>

<span class="n">V</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s2">&quot;V&quot;</span><span class="p">,</span> <span class="n">covariant</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">Self</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s2">&quot;Self&quot;</span><span class="p">,</span> <span class="n">bound</span><span class="o">=</span><span class="s2">&quot;ConfigurationBase&quot;</span><span class="p">)</span>
<span class="n">_MappingLike</span> <span class="o">=</span> <span class="n">Union</span><span class="p">[</span><span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]]</span>


<span class="k">class</span> <span class="nc">InvalidKeyError</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Raised when a key can not be used in a configuration object.&quot;&quot;&quot;</span>

    <span class="k">pass</span>


<div class="viewcode-block" id="ConfigurationBase">
<a class="viewcode-back" href="../../generated/upsilonconf.ConfigurationBase.html#upsilonconf.ConfigurationBase">[docs]</a>
<span class="k">class</span> <span class="nc">ConfigurationBase</span><span class="p">(</span><span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">V</span><span class="p">],</span> <span class="n">ABC</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Interface for configuration objects.</span>

<span class="sd">    This interface can be interpreted in essentially two ways:</span>

<span class="sd">    - a dictionary (or mapping) with attribute syntax, or</span>
<span class="sd">    - an object with indexing syntax.</span>

<span class="sd">    On top of the combined feature set of dictionaries and attributes,</span>
<span class="sd">    this class provides convenient indexing, merging and conversions.</span>
<span class="sd">    Values of type ``dict`` (or other mapping types) will be</span>
<span class="sd">    automatically converted to configuration objects,</span>
<span class="sd">    giving rise to hierarchical configuration objects.</span>

<span class="sd">    .. versionadded:: 0.7.0</span>

<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    PlainConfiguration : implementation of mutable configuration.</span>
<span class="sd">    FrozenConfiguration : implementation of immutable configuration.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># TODO: drop py3.6 support for proper generics?</span>
<div class="viewcode-block" id="ConfigurationBase.FlatConfigView">
<a class="viewcode-back" href="../../generated/upsilonconf.ConfigurationBase.html#upsilonconf.ConfigurationBase.FlatConfigView">[docs]</a>
    <span class="k">class</span> <span class="nc">FlatConfigView</span><span class="p">(</span><span class="n">Collection</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Flat view of configuration object.&quot;&quot;&quot;</span>

        <span class="vm">__slots__</span> <span class="o">=</span> <span class="s2">&quot;_config&quot;</span>

        <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="s2">&quot;ConfigurationBase&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_config</span> <span class="o">=</span> <span class="n">config</span>

        <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">(</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_config</span><span class="si">!r}</span><span class="s2">)&quot;</span>

        <span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="mi">1</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__iter__</span><span class="p">())</span>

        <span class="nd">@abstractmethod</span>
        <span class="k">def</span> <span class="fm">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span> <span class="o">...</span>

        <span class="nd">@abstractmethod</span>
        <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">:</span> <span class="o">...</span>

        <span class="k">def</span> <span class="nf">_flat_iter</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Iterate over key-value pairs of flat config.</span>

<span class="sd">            The flattened config uses dot-separated strings</span>
<span class="sd">            to represent values in sub-configs.</span>

<span class="sd">            Yields</span>
<span class="sd">            ------</span>
<span class="sd">            key : str</span>
<span class="sd">                A dot-separated key.</span>
<span class="sd">            value</span>
<span class="sd">                The value corresponding to that key.</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_config</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_config</span><span class="o">.</span><span class="vm">__class__</span><span class="p">):</span>
                    <span class="k">yield from</span> <span class="p">(</span>
                        <span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">key</span><span class="p">,</span> <span class="n">sub_key</span><span class="p">]),</span> <span class="n">v</span><span class="p">)</span>
                        <span class="k">for</span> <span class="n">sub_key</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">ConfigurationBase</span><span class="o">.</span><span class="n">FlatItemsView</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">yield</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span></div>


<div class="viewcode-block" id="ConfigurationBase.FlatItemsView">
<a class="viewcode-back" href="../../generated/upsilonconf.ConfigurationBase.html#upsilonconf.ConfigurationBase.FlatItemsView">[docs]</a>
    <span class="k">class</span> <span class="nc">FlatItemsView</span><span class="p">(</span><span class="n">FlatConfigView</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Flat view of key-value pairs in configuration.&quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="fm">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
            <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="o">=</span> <span class="n">item</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_config</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_config</span><span class="o">.</span><span class="vm">__class__</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span>
                    <span class="n">v</span> <span class="ow">is</span> <span class="n">value</span> <span class="ow">or</span> <span class="n">v</span> <span class="o">==</span> <span class="n">value</span>
                <span class="p">)</span>

        <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
            <span class="k">yield from</span> <span class="bp">self</span><span class="o">.</span><span class="n">_flat_iter</span><span class="p">()</span></div>


<div class="viewcode-block" id="ConfigurationBase.FlatKeysView">
<a class="viewcode-back" href="../../generated/upsilonconf.ConfigurationBase.html#upsilonconf.ConfigurationBase.FlatKeysView">[docs]</a>
    <span class="k">class</span> <span class="nc">FlatKeysView</span><span class="p">(</span><span class="n">FlatConfigView</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Flat view of keys in configuration.&quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="fm">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_config</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_config</span><span class="o">.</span><span class="vm">__class__</span><span class="p">)</span>

        <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
            <span class="k">yield from</span> <span class="p">(</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_flat_iter</span><span class="p">())</span></div>


<div class="viewcode-block" id="ConfigurationBase.FlatValuesView">
<a class="viewcode-back" href="../../generated/upsilonconf.ConfigurationBase.html#upsilonconf.ConfigurationBase.FlatValuesView">[docs]</a>
    <span class="k">class</span> <span class="nc">FlatValuesView</span><span class="p">(</span><span class="n">FlatConfigView</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Flat view of values in configuration.&quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="fm">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">any</span><span class="p">(</span><span class="n">v</span> <span class="ow">is</span> <span class="n">value</span> <span class="ow">or</span> <span class="n">v</span> <span class="o">==</span> <span class="n">value</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_flat_iter</span><span class="p">())</span>

        <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">Any</span><span class="p">]:</span>
            <span class="k">yield from</span> <span class="p">(</span><span class="n">v</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_flat_iter</span><span class="p">())</span></div>


    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">V</span><span class="p">):</span> <span class="o">...</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">kwargs</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;=&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">k</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">v</span><span class="si">!r}</span><span class="s2">&quot;</span><span class="p">])</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">items</span><span class="p">()]</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">(</span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span><span class="si">}</span><span class="s2">)&quot;</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">kwargs</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;: &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">k</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">v</span><span class="si">!s}</span><span class="s2">&quot;</span><span class="p">])</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">items</span><span class="p">()]</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">{{</span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span><span class="si">}</span><span class="se">}}</span><span class="s2">&quot;</span>

    <span class="c1"># # # Attribute Access # # #</span>

    <span class="k">def</span> <span class="fm">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">V</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&#39; object has no attribute &#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
        <span class="k">if</span> <span class="s2">&quot;.&quot;</span> <span class="ow">in</span> <span class="n">name</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;dot-strings only work for indexing, try `config[</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">]` instead&quot;</span>

        <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="c1"># # # Mapping Interface # # #</span>

    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="o">...</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="n">V</span><span class="p">:</span>
        <span class="n">conf</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">unresolved</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_resolve_key</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">unresolved</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">conf</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>

    <span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="fm">__len__</span><span class="p">()</span>

    <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="k">return</span> <span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">)</span>

    <span class="c1"># # # Merging # # #</span>

    <span class="k">def</span> <span class="fm">__or__</span><span class="p">(</span><span class="bp">self</span><span class="p">:</span> <span class="n">Self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">V</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Self</span><span class="p">:</span>
        <span class="bp">cls</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="bp">cls</span><span class="p">):</span>
            <span class="n">other</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span><span class="o">**</span><span class="n">other</span><span class="p">)</span>

        <span class="n">kwargs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="n">k</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fix_value</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">old_val</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
                <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">other</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
            <span class="p">}</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__ror__</span><span class="p">(</span><span class="bp">self</span><span class="p">:</span> <span class="n">Self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">V</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Self</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="o">**</span><span class="n">other</span><span class="p">)</span> <span class="o">|</span> <span class="bp">self</span>

    <span class="c1"># # # Flat Iterators # # #</span>

    <span class="nd">@overload</span>
    <span class="k">def</span> <span class="nf">keys</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">flat</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="kc">False</span><span class="p">]</span> <span class="o">=</span> <span class="o">...</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">KeysView</span><span class="p">:</span> <span class="o">...</span>

    <span class="nd">@overload</span>
    <span class="k">def</span> <span class="nf">keys</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">flat</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="kc">True</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">FlatKeysView</span><span class="p">:</span> <span class="o">...</span>

    <span class="nd">@overload</span>
    <span class="k">def</span> <span class="nf">keys</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">flat</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="o">...</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">KeysView</span><span class="p">,</span> <span class="n">FlatKeysView</span><span class="p">]:</span> <span class="o">...</span>

<div class="viewcode-block" id="ConfigurationBase.keys">
<a class="viewcode-back" href="../../generated/upsilonconf.ConfigurationBase.html#upsilonconf.ConfigurationBase.keys">[docs]</a>
    <span class="k">def</span> <span class="nf">keys</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">flat</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get a view of this configuration&#39;s keys.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        flat : bool, optional</span>
<span class="sd">            If ``True``, the hierarchy of this config is ignored.</span>
<span class="sd">            This means that instead of including subconfigs,</span>
<span class="sd">            the subconfigs are recursively flattened in the view.</span>
<span class="sd">            The subconfig-key and keys in the subconfig are combined</span>
<span class="sd">            using ``.``-syntax, making them valid indices for this object.</span>
<span class="sd">            If ``False`` (default), a ``dict``-like view is returned.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        keys_view : KeysView or FlatKeysView</span>
<span class="sd">            The new view on the keys in this config.</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        values : view on values</span>
<span class="sd">        items : view on key-value pairs</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        The examples below work for any subclass of `ConfigurationBase`.</span>

<span class="sd">        &gt;&gt;&gt; from upsilonconf import PlainConfiguration as Config</span>


<span class="sd">        &gt;&gt;&gt; conf = Config(a=123, sub=Config(b=&quot;foo&quot;, c=None))</span>
<span class="sd">        &gt;&gt;&gt; list(conf.keys())</span>
<span class="sd">        [&#39;a&#39;, &#39;sub&#39;]</span>
<span class="sd">        &gt;&gt;&gt; list(conf.keys(flat=True))</span>
<span class="sd">        [&#39;a&#39;, &#39;sub.b&#39;, &#39;sub.c&#39;]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">flat</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="n">FlatKeysView</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div>


    <span class="nd">@overload</span>
    <span class="k">def</span> <span class="nf">values</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">flat</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="kc">False</span><span class="p">]</span> <span class="o">=</span> <span class="o">...</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ValuesView</span><span class="p">:</span> <span class="o">...</span>

    <span class="nd">@overload</span>
    <span class="k">def</span> <span class="nf">values</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">flat</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="kc">True</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">FlatValuesView</span><span class="p">:</span> <span class="o">...</span>

    <span class="nd">@overload</span>
    <span class="k">def</span> <span class="nf">values</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">flat</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="o">...</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">ValuesView</span><span class="p">,</span> <span class="n">FlatValuesView</span><span class="p">]:</span> <span class="o">...</span>

<div class="viewcode-block" id="ConfigurationBase.values">
<a class="viewcode-back" href="../../generated/upsilonconf.ConfigurationBase.html#upsilonconf.ConfigurationBase.values">[docs]</a>
    <span class="k">def</span> <span class="nf">values</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">flat</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get a view of this configuration&#39;s values.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        flat : bool, optional</span>
<span class="sd">            If ``True``, the hierarchy of this config is ignored.</span>
<span class="sd">            This means that instead of including subconfigs,</span>
<span class="sd">            the subconfigs are recursively flattened in the view.</span>
<span class="sd">            The subconfig-key and keys in the subconfig are combined</span>
<span class="sd">            using ``.``-syntax, making them valid indices for this object.</span>
<span class="sd">            If ``False`` (default), a ``dict``-like view is returned.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        values_view : ValuesView or FlatValuesView</span>
<span class="sd">            The new view on the values in this config.</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        keys : view on keys</span>
<span class="sd">        items : view on key-value pairs</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        The examples below work for any subclass of `ConfigurationBase`.</span>

<span class="sd">        &gt;&gt;&gt; from upsilonconf import PlainConfiguration as Config</span>


<span class="sd">        &gt;&gt;&gt; conf = Config(a=123, sub=Config(b=&quot;foo&quot;, c=None))</span>
<span class="sd">        &gt;&gt;&gt; list(conf.values())</span>
<span class="sd">        [123, PlainConfiguration(b=&#39;foo&#39;, c=None)]</span>
<span class="sd">        &gt;&gt;&gt; list(conf.values(flat=True))</span>
<span class="sd">        [123, &#39;foo&#39;, None]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">flat</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="n">FlatValuesView</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div>


    <span class="nd">@overload</span>
    <span class="k">def</span> <span class="nf">items</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">flat</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="kc">False</span><span class="p">]</span> <span class="o">=</span> <span class="o">...</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ItemsView</span><span class="p">:</span> <span class="o">...</span>

    <span class="nd">@overload</span>
    <span class="k">def</span> <span class="nf">items</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">flat</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="kc">True</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">FlatItemsView</span><span class="p">:</span> <span class="o">...</span>

    <span class="nd">@overload</span>
    <span class="k">def</span> <span class="nf">items</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">flat</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="o">...</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">ItemsView</span><span class="p">,</span> <span class="n">FlatItemsView</span><span class="p">]:</span> <span class="o">...</span>

<div class="viewcode-block" id="ConfigurationBase.items">
<a class="viewcode-back" href="../../generated/upsilonconf.ConfigurationBase.html#upsilonconf.ConfigurationBase.items">[docs]</a>
    <span class="k">def</span> <span class="nf">items</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">flat</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get a view of this configuration&#39;s key-value pairs.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        flat : bool, optional</span>
<span class="sd">            If ``True``, the hierarchy of this config is ignored.</span>
<span class="sd">            This means that instead of including subconfigs,</span>
<span class="sd">            the subconfigs are recursively flattened in the view.</span>
<span class="sd">            The subconfig-key and keys in the subconfig are combined</span>
<span class="sd">            using ``.``-syntax, making them valid indices for this object.</span>
<span class="sd">            If ``False`` (default), a ``dict``-like view is returned.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        items_view : ItemsView or FlatItemsView</span>
<span class="sd">            The new view on the key-value pairs in this config.</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        keys : view on keys</span>
<span class="sd">        values : view on values</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        The examples below work for any subclass of `ConfigurationBase`.</span>

<span class="sd">        &gt;&gt;&gt; from upsilonconf import PlainConfiguration as Config</span>


<span class="sd">        &gt;&gt;&gt; conf = Config(a=123, sub=Config(b=&quot;foo&quot;, c=None))</span>
<span class="sd">        &gt;&gt;&gt; list(conf.items())</span>
<span class="sd">        [(&#39;a&#39;, 123), (&#39;sub&#39;, PlainConfiguration(b=&#39;foo&#39;, c=None))]</span>
<span class="sd">        &gt;&gt;&gt; list(conf.items(flat=True))</span>
<span class="sd">        [(&#39;a&#39;, 123), (&#39;sub.b&#39;, &#39;foo&#39;), (&#39;sub.c&#39;, None)]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">flat</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="n">FlatItemsView</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div>


    <span class="c1"># # # Key Magic # # #</span>

    <span class="k">def</span> <span class="nf">_resolve_key</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">:</span> <span class="n">Self</span><span class="p">,</span> <span class="n">keys</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="o">...</span><span class="p">]]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Self</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="o">...</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Resolve dot-string and iterable keys in this configuration.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        keys : str or iterable of str</span>
<span class="sd">            The key(s) to be resolved.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        config : PlainConfiguration</span>
<span class="sd">            The deepest existing sub-configuration as specified by `keys`.</span>
<span class="sd">        op_key : str</span>
<span class="sd">            The key to perform the desired operation on `config`.</span>
<span class="sd">            This is either the first unresolved (nonexistent) key</span>
<span class="sd">            or the final key in the hierarchy, which might exist.</span>
<span class="sd">        unresolved : tuple of str</span>
<span class="sd">            The keys that could not be resolved, i.e. do not exist (yet).</span>
<span class="sd">            This value does **not** include `op_key`.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        KeyError</span>
<span class="sd">            If any of the sub-keys (apart from the final key)</span>
<span class="sd">            point to a value that is not a configuration.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">type_err_msg</span> <span class="o">=</span> <span class="s2">&quot;index must be string or a tuple of strings, but got </span><span class="si">{}</span><span class="s2">&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">keys</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">keys</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">keys</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">))</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">keys</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">type_err_msg</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&#39;</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">keys</span><span class="p">)</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">))</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">keys</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">InvalidKeyError</span><span class="p">(</span><span class="s2">&quot;empty tuple&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">any</span><span class="p">(</span><span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">):</span>
            <span class="n">proto</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">keys</span> <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="nb">str</span><span class="p">))</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">type_err_msg</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;tuple of &#39;</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">proto</span><span class="p">)</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">))</span>

        <span class="o">*</span><span class="n">sub_keys</span><span class="p">,</span> <span class="n">op_key</span> <span class="o">=</span> <span class="n">keys</span>

        <span class="n">root</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="n">sub_key_iter</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">(</span><span class="n">sub_keys</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">sub_key_iter</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">root</span> <span class="o">=</span> <span class="n">root</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">root</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="p">(</span><span class="o">*</span><span class="n">sub_key_iter</span><span class="p">,</span> <span class="n">op_key</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">((</span><span class="n">k</span><span class="p">,</span> <span class="o">*</span><span class="n">sub_key_iter</span><span class="p">,</span> <span class="n">op_key</span><span class="p">)))</span>

        <span class="k">return</span> <span class="n">root</span><span class="p">,</span> <span class="n">op_key</span><span class="p">,</span> <span class="p">()</span>

    <span class="nd">@classmethod</span>
    <span class="nd">@overload</span>
    <span class="k">def</span> <span class="nf">_fix_value</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="n">Self</span><span class="p">],</span>
        <span class="n">value</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">V</span><span class="p">],</span>
        <span class="n">wrappers</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="p">(),</span>
        <span class="n">old_val</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">V</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Self</span><span class="p">:</span> <span class="o">...</span>

    <span class="nd">@classmethod</span>
    <span class="nd">@overload</span>
    <span class="k">def</span> <span class="nf">_fix_value</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">value</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
        <span class="n">wrappers</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="p">(),</span>
        <span class="n">old_val</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">V</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">V</span><span class="p">:</span> <span class="o">...</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_fix_value</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">wrappers</span><span class="o">=</span><span class="p">(),</span> <span class="n">old_val</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Prepare value for storage in this configuration.</span>

<span class="sd">        This method assures that the value satisfies the invariants</span>
<span class="sd">        and does not unnecessarily destroy the old value.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        value</span>
<span class="sd">            The new value before storing.</span>
<span class="sd">        old_val (optional)</span>
<span class="sd">            The value that is going to be replaced by this value.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        new_value</span>
<span class="sd">            The value that is ready to be stored.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">wrappers</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span><span class="o">**</span><span class="p">{</span><span class="n">key</span><span class="p">:</span> <span class="n">value</span><span class="p">})</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span><span class="o">**</span><span class="n">value</span><span class="p">)</span>
            <span class="n">old_val</span> <span class="o">|=</span> <span class="n">value</span>
            <span class="k">return</span> <span class="n">old_val</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">value</span>

    <span class="c1"># # # File Interactions # # #</span>

<div class="viewcode-block" id="ConfigurationBase.load">
<a class="viewcode-back" href="../../generated/upsilonconf.ConfigurationBase.html#upsilonconf.ConfigurationBase.load">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">load</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="n">Self</span><span class="p">],</span>
        <span class="n">path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Path</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">overrides</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">V</span><span class="p">],</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">V</span><span class="p">]]]</span> <span class="o">=</span> <span class="p">(),</span>
        <span class="n">key_mods</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">io</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ConfigIO</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Self</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Load configuration from a file.</span>

<span class="sd">        .. versionadded:: 0.8.0</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        path : Path or str</span>
<span class="sd">            Path to a readable text file on disk.</span>
<span class="sd">        overrides : dict or sequence of tuples, optional</span>
<span class="sd">            Collection of key-value pairs to update the original configuration with.</span>
<span class="sd">            This enables adding keys and overriding values for existing keys.</span>
<span class="sd">        key_mods : dict, optional</span>
<span class="sd">            A mapping from key patterns to their respective replacement.</span>
<span class="sd">            With multiple patterns, longer patterns are replaced first.</span>
<span class="sd">        io : ConfigIO, optional</span>
<span class="sd">            The IO used for parsing the configuration file to a dictionary.</span>
<span class="sd">            If not specified, the default IO will be used.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        config : ConfigurationBase</span>
<span class="sd">            A configuration object with the values as provided in the file.</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        from_dict : method used for key modifications</span>
<span class="sd">        ConfigIO.read : read configuration file</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">io</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">io</span> <span class="o">=</span> <span class="n">get_default_io</span><span class="p">()</span>

        <span class="n">m</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="n">m</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">overrides</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">key_mods</span><span class="o">=</span><span class="n">key_mods</span><span class="p">)</span></div>


<div class="viewcode-block" id="ConfigurationBase.save">
<a class="viewcode-back" href="../../generated/upsilonconf.ConfigurationBase.html#upsilonconf.ConfigurationBase.save">[docs]</a>
    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Path</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">key_mods</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">io</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ConfigIO</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Save configuration to a file.</span>

<span class="sd">        .. versionadded:: 0.8.0</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        path : Path or str</span>
<span class="sd">            Path to a writeable location on disk.</span>
<span class="sd">        key_mods : dict, optional</span>
<span class="sd">            A mapping from key patterns to their respective replacement.</span>
<span class="sd">            With multiple patterns, longer patterns are replaced first.</span>
<span class="sd">        io : ConfigIO, optional</span>
<span class="sd">            The IO used for writing a dictionary to the configuration file.</span>
<span class="sd">            If not specified, the default IO will be used.</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        to_dict : method used for key modifications</span>
<span class="sd">        ConfigIO.write : write configuration file</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">io</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">io</span> <span class="o">=</span> <span class="n">get_default_io</span><span class="p">()</span>

        <span class="n">m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="n">key_mods</span><span class="o">=</span><span class="n">key_mods</span><span class="p">)</span>
        <span class="n">io</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span></div>


<div class="viewcode-block" id="ConfigurationBase.from_cli">
<a class="viewcode-back" href="../../generated/upsilonconf.ConfigurationBase.html#upsilonconf.ConfigurationBase.from_cli">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_cli</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="n">Self</span><span class="p">],</span>
        <span class="n">args</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">parser</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">ConfigParser</span><span class="p">,</span> <span class="n">ArgumentParser</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">key_mods</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">io</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ConfigIO</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">Self</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Self</span><span class="p">,</span> <span class="n">Namespace</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create configuration from command-line arguments.</span>

<span class="sd">        .. versionadded:: 0.8.0</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        args : sequence of str, optional</span>
<span class="sd">            The list of arguments to parse.</span>
<span class="sd">            By default, arguments are taken from ``sys.argv``.</span>
<span class="sd">        parser : ArgumentParser or ConfigParser, optional</span>
<span class="sd">            The CLI parser to use as a base for retrieving configuration options.</span>
<span class="sd">            If not specified, an empty parser will be created.</span>
<span class="sd">        io : ConfigIO, optional</span>
<span class="sd">            Specifies how configuration files and command-line arguments are read.</span>
<span class="sd">            This argument is ignored if a `ConfigParser` is passed for `parser`.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        config : ConfigurationBase</span>
<span class="sd">            A configuration object with keys and values as specified</span>
<span class="sd">            through the command line arguments.</span>
<span class="sd">        ns : Namespace, optional</span>
<span class="sd">            A namespace object with non-configuration arguments.</span>
<span class="sd">            This is only returned if `parser` is given and</span>
<span class="sd">            not a `ConfigParser` object with ``return_ns == False``.</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        from_dict : method used for key modifications</span>
<span class="sd">        ConfigParser.parse_cli : parse CLI arguments</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">io_given</span> <span class="o">=</span> <span class="n">io</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">io</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">io</span> <span class="o">=</span> <span class="n">get_default_io</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">parser</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">parser</span> <span class="o">=</span> <span class="n">ConfigParser</span><span class="p">(</span><span class="n">io</span><span class="p">)</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">parser</span><span class="p">,</span> <span class="n">ConfigParser</span><span class="p">):</span>
            <span class="n">parser</span> <span class="o">=</span> <span class="n">ConfigParser</span><span class="p">(</span><span class="n">io</span><span class="p">,</span> <span class="n">parser</span><span class="o">=</span><span class="n">parser</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">io_given</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                <span class="s2">&quot;ignoring io argument, using io from ConfigParser argument&quot;</span><span class="p">,</span>
                <span class="ne">UserWarning</span><span class="p">,</span>
                <span class="n">stacklevel</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="n">out</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_cli</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">key_mods</span><span class="o">=</span><span class="n">key_mods</span><span class="p">),</span> <span class="n">out</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">key_mods</span><span class="o">=</span><span class="n">key_mods</span><span class="p">)</span></div>


    <span class="c1"># # # Dict Conversion # # #</span>

<div class="viewcode-block" id="ConfigurationBase.from_dict">
<a class="viewcode-back" href="../../generated/upsilonconf.ConfigurationBase.html#upsilonconf.ConfigurationBase.from_dict">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_dict</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="n">Self</span><span class="p">],</span>
        <span class="n">mapping</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">V</span><span class="p">],</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">key_mods</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Self</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a configuration from another mapping.</span>

<span class="sd">        In its simplest form, this method unpacks the dictionary</span>
<span class="sd">        and passes the key-value pairs as arguments to the constructor.</span>
<span class="sd">        The `key_mods` argument additionally allows to *clean up* keys.</span>

<span class="sd">        .. versionchanged:: 0.8.0</span>
<span class="sd">           `key_mods` can no longer be passed as positional argument.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        mapping : Mapping[str, V]</span>
<span class="sd">            The dictionary from which to create a configuration object.</span>
<span class="sd">        key_mods : Mapping[str, str], optional</span>
<span class="sd">            A mapping from key patterns to their respective replacement.</span>
<span class="sd">            With multiple patterns, longer patterns are replaced first.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        config : ConfigurationBase</span>
<span class="sd">            A configuration object representing the original mapping</span>
<span class="sd">            where any occurrence of patterns in `keys_mods`</span>
<span class="sd">            in the original keys has been replaced.</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        to_dict : inverse conversion from config to mapping.</span>
<span class="sd">        __init__ : regular constructor.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        The examples below work for any subclass of `ConfigurationBase`.</span>

<span class="sd">        &gt;&gt;&gt; from upsilonconf import PlainConfiguration as Config</span>

<span class="sd">        Without `key_mods`, the dictionary is equivalent to `__init__`.</span>

<span class="sd">        &gt;&gt;&gt; d = {&quot;my key&quot;: &quot;foo&quot;, &quot;a key&quot;: 1}</span>
<span class="sd">        &gt;&gt;&gt; conf = Config.from_dict(d)</span>
<span class="sd">        &gt;&gt;&gt; conf</span>
<span class="sd">        PlainConfiguration(my key=&#39;foo&#39;, a key=1)</span>
<span class="sd">        &gt;&gt;&gt; conf[&quot;my key&quot;]</span>
<span class="sd">        &#39;foo&#39;</span>

<span class="sd">        By using the `key_mods` argument, keys can become more accessible.</span>

<span class="sd">        &gt;&gt;&gt; conf = Config.from_dict(d, key_mods={&quot; &quot;: &quot;_&quot;})</span>
<span class="sd">        &gt;&gt;&gt; conf</span>
<span class="sd">        PlainConfiguration(my_key=&#39;foo&#39;, a_key=1)</span>
<span class="sd">        &gt;&gt;&gt; conf.my_key</span>
<span class="sd">        &#39;foo&#39;</span>

<span class="sd">        Flat ``dict``s can also be converted to a hierarchical config.</span>

<span class="sd">        &gt;&gt;&gt; conf = Config.from_dict(d, key_mods={&quot; &quot;: &quot;.&quot;})</span>
<span class="sd">        &gt;&gt;&gt; conf</span>
<span class="sd">        PlainConfiguration(my=PlainConfiguration(key=&#39;foo&#39;), a=PlainConfiguration(key=1))</span>

<span class="sd">        Multiple replacements can be combined in a single call.</span>

<span class="sd">        &gt;&gt;&gt; conf = Config.from_dict(d, key_mods={&quot; &quot;: &quot;_&quot;, &quot;e&quot;: &quot;3&quot;})</span>
<span class="sd">        &gt;&gt;&gt; conf</span>
<span class="sd">        PlainConfiguration(my_k3y=&#39;foo&#39;, a_k3y=1)</span>

<span class="sd">        Note that replacements are executed in order of length.</span>

<span class="sd">        &gt;&gt;&gt; conf = Config.from_dict(d, key_mods={&quot;my &quot;: &quot;A&quot;, &quot; &quot;: &quot;B&quot;})</span>
<span class="sd">        &gt;&gt;&gt; conf</span>
<span class="sd">        PlainConfiguration(Akey=&#39;foo&#39;, aBkey=1)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">key_mods</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">key_mods</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="o">**</span><span class="n">_modify_keys</span><span class="p">(</span><span class="n">mapping</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">key_mods</span><span class="p">))</span></div>


<div class="viewcode-block" id="ConfigurationBase.to_dict">
<a class="viewcode-back" href="../../generated/upsilonconf.ConfigurationBase.html#upsilonconf.ConfigurationBase.to_dict">[docs]</a>
    <span class="k">def</span> <span class="nf">to_dict</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">key_mods</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">flat</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">V</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Convert this configuration to a dictionary.</span>

<span class="sd">        This method transfers the key-value pairs in this configuratio</span>
<span class="sd">        to a dictionary recursively (for hierarchical configurations).</span>
<span class="sd">        The `key_mods` argument additionally allows to modify keys.</span>
<span class="sd">        The `flat` argument allows to flatten hierarchical configurations.</span>

<span class="sd">        .. versionchanged:: 0.8.0</span>
<span class="sd">           `key_mods` can no longer be passed as positional argument.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        key_mods : Mapping[str, str], optional</span>
<span class="sd">            A mapping from key patterns to their respective replacement.</span>
<span class="sd">            With multiple patterns, longer patterns are replaced first.</span>
<span class="sd">        flat : bool, optional</span>
<span class="sd">            Discard the hierarchy in this configuration object.</span>
<span class="sd">            When ``True``, keys in subconfigurations are converted to</span>
<span class="sd">            dot-strings that are valid indices for this configuration.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        mapping : dict[str, V]</span>
<span class="sd">            A ``dict`` representing this configuration</span>
<span class="sd">            where any occurrence of patterns in `keys_mods`</span>
<span class="sd">            in the original keys has been replaced.</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        from_dict : inverse conversion from mapping to config.</span>
<span class="sd">        items : iterate over (flattened) key-value pairs.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        The examples below work for any subclass of `ConfigurationBase`.</span>

<span class="sd">        &gt;&gt;&gt; from upsilonconf import PlainConfiguration as Config</span>

<span class="sd">        For configurations without hierarchy,</span>
<span class="sd">        this method has the same effect as calling ``dict``.</span>

<span class="sd">        &gt;&gt;&gt; conf = Config(my_key=&quot;foo&quot;, a_key=1)</span>
<span class="sd">        &gt;&gt;&gt; dict(conf)</span>
<span class="sd">        {&#39;my_key&#39;: &#39;foo&#39;, &#39;a_key&#39;: 1}</span>
<span class="sd">        &gt;&gt;&gt; conf.to_dict()</span>
<span class="sd">        {&#39;my_key&#39;: &#39;foo&#39;, &#39;a_key&#39;: 1}</span>

<span class="sd">        For hierarchical configurations,</span>
<span class="sd">        the conversion is applied recursively.</span>

<span class="sd">        &gt;&gt;&gt; conf = Config(sub=conf)</span>
<span class="sd">        &gt;&gt;&gt; dict(conf)</span>
<span class="sd">        {&#39;sub&#39;: PlainConfiguration(my_key=&#39;foo&#39;, a_key=1)}</span>
<span class="sd">        &gt;&gt;&gt; conf.to_dict()</span>
<span class="sd">        {&#39;sub&#39;: {&#39;my_key&#39;: &#39;foo&#39;, &#39;a_key&#39;: 1}}</span>

<span class="sd">        The hierarchy can also be discarded using the `flat` argument.</span>

<span class="sd">        &gt;&gt;&gt; conf.to_dict(flat=True)</span>
<span class="sd">        {&#39;sub.my_key&#39;: &#39;foo&#39;, &#39;sub.a_key&#39;: 1}</span>

<span class="sd">        By using the `key_mods` argument, keys can be made more readable.</span>

<span class="sd">        &gt;&gt;&gt; conf.to_dict(key_mods={&quot;_&quot;: &quot; &quot;})</span>
<span class="sd">        {&#39;sub&#39;: {&#39;my key&#39;: &#39;foo&#39;, &#39;a key&#39;: 1}}</span>

<span class="sd">        Also, dot-strings from flattening can be replaced.</span>

<span class="sd">        &gt;&gt;&gt; conf.to_dict(flat=True, key_mods={&quot;.&quot;: &quot;_&quot;})</span>
<span class="sd">        {&#39;sub_my_key&#39;: &#39;foo&#39;, &#39;sub_a_key&#39;: 1}</span>

<span class="sd">        Multiple replacements can be combined in a single call.</span>

<span class="sd">        &gt;&gt;&gt; conf.to_dict(key_mods={&quot;_&quot;: &quot; &quot;, &quot;e&quot;: &quot;3&quot;})</span>
<span class="sd">        {&#39;sub&#39;: {&#39;my k3y&#39;: &#39;foo&#39;, &#39;a k3y&#39;: 1}}</span>

<span class="sd">        Note that replacements are executed in order of length.</span>

<span class="sd">        &gt;&gt;&gt; conf.to_dict(key_mods={&quot;my_&quot;: &quot;A&quot;, &quot;_&quot;: &quot;B&quot;})</span>
<span class="sd">        {&#39;sub&#39;: {&#39;Akey&#39;: &#39;foo&#39;, &#39;aBkey&#39;: 1}}</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">key_mods</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">key_mods</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">return</span> <span class="n">_modify_keys</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">(</span><span class="n">flat</span><span class="o">=</span><span class="n">flat</span><span class="p">),</span> <span class="n">key_mods</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="PlainConfiguration">
<a class="viewcode-back" href="../../generated/upsilonconf.PlainConfiguration.html#upsilonconf.PlainConfiguration">[docs]</a>
<span class="k">class</span> <span class="nc">PlainConfiguration</span><span class="p">(</span><span class="n">ConfigurationBase</span><span class="p">[</span><span class="n">Any</span><span class="p">],</span> <span class="n">MutableMapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Mutable configuration.</span>

<span class="sd">    `PlainConfiguration` is a mutable `ConfigurationBase` implementation.</span>
<span class="sd">    This means that values can be added, changed and/or deleted.</span>

<span class="sd">    .. versionadded:: 0.7.0</span>

<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    ConfigurationBase : the configuration interface.</span>
<span class="sd">    FrozenConfiguration : an immutable configuration.</span>

<span class="sd">    Warnings</span>
<span class="sd">    --------</span>
<span class="sd">    In the current implementation, using method names as keys is possible,</span>

<span class="sd">    &gt;&gt;&gt; conf = PlainConfiguration()</span>
<span class="sd">    &gt;&gt;&gt; print(conf.items)</span>
<span class="sd">    &lt;bound method ConfigurationBase.items of PlainConfiguration()&gt;</span>
<span class="sd">    &gt;&gt;&gt; conf[&quot;items&quot;] = 123</span>
<span class="sd">    &gt;&gt;&gt; print(conf.items)</span>
<span class="sd">    123</span>

<span class="sd">    but it can lead to some unexpected behaviour.</span>

<span class="sd">    &gt;&gt;&gt; print(conf)</span>
<span class="sd">    {items: 123}</span>
<span class="sd">    &gt;&gt;&gt; conf == {&quot;items&quot;: 123}</span>
<span class="sd">    Traceback (most recent call last):</span>
<span class="sd">        ...</span>
<span class="sd">    TypeError: &#39;int&#39; object is not callable</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    Starting with a simple configuration.</span>

<span class="sd">    &gt;&gt;&gt; conf = PlainConfiguration(foo=0, bar=&quot;bar&quot;, baz={&#39;a&#39;: 1, &#39;b&#39;: 2})</span>
<span class="sd">    &gt;&gt;&gt; print(conf)</span>
<span class="sd">    {foo: 0, bar: bar, baz: {a: 1, b: 2}}</span>

<span class="sd">    Variables can be added, changed or removed as desired.</span>

<span class="sd">    &gt;&gt;&gt; conf.surprise = None</span>
<span class="sd">    &gt;&gt;&gt; print(conf)</span>
<span class="sd">    {foo: 0, bar: bar, baz: {a: 1, b: 2}, surprise: None}</span>
<span class="sd">    &gt;&gt;&gt; conf[&quot;surprise&quot;] = []</span>
<span class="sd">    &gt;&gt;&gt; print(conf)</span>
<span class="sd">    {foo: 0, bar: bar, baz: {a: 1, b: 2}, surprise: []}</span>
<span class="sd">    &gt;&gt;&gt; del conf.baz.a</span>
<span class="sd">    &gt;&gt;&gt; print(conf)</span>
<span class="sd">    {foo: 0, bar: bar, baz: {b: 2}, surprise: []}</span>

<span class="sd">    Creating a single value in a subconfig is possible,</span>
<span class="sd">    but only using indexing syntax, not with attribute syntax.</span>

<span class="sd">    &gt;&gt;&gt; conf.sub.val = 0</span>
<span class="sd">    Traceback (most recent call last):</span>
<span class="sd">        ...</span>
<span class="sd">    AttributeError: &#39;PlainConfiguration&#39; object has no attribute &#39;sub&#39;</span>
<span class="sd">    &gt;&gt;&gt; conf[&quot;sub&quot;, &quot;val&quot;] = -1</span>
<span class="sd">    &gt;&gt;&gt; print(conf)</span>
<span class="sd">    {foo: 0, bar: bar, baz: {b: 2}, surprise: [], sub: {val: -1}}</span>
<span class="sd">    &gt;&gt;&gt; conf[&#39;surprise&#39;] = {&quot;val&quot;: &quot;tada&quot;}</span>
<span class="sd">    &gt;&gt;&gt; print(conf)</span>
<span class="sd">    {foo: 0, bar: bar, baz: {b: 2}, surprise: {val: tada}, sub: {val: -1}}</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="c1"># # # Attribute Access # # #</span>

    <span class="k">def</span> <span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="s2">&quot;.&quot;</span> <span class="ow">in</span> <span class="n">name</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;dot-strings only work for indexing, try `config[</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">]` instead&quot;</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fix_value</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>

    <span class="k">def</span> <span class="fm">__delattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
        <span class="k">if</span> <span class="s2">&quot;.&quot;</span> <span class="ow">in</span> <span class="n">name</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;dot-strings only work for indexing, try `config[</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">]` instead&quot;</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__delattr__</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

    <span class="c1"># # # Mapping Interface # # #</span>

    <span class="k">def</span> <span class="fm">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="o">...</span><span class="p">]],</span> <span class="n">value</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">conf</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">unresolved</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_resolve_key</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="n">conf</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fix_value</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">unresolved</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__delitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="o">...</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">conf</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">unresolved</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_resolve_key</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">unresolved</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="k">del</span> <span class="n">conf</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>

    <span class="c1"># # # Merging # # #</span>

    <span class="k">def</span> <span class="fm">__ior__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">):</span>
            <span class="n">other</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="o">**</span><span class="n">other</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">other</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="bp">self</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fix_value</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">old_val</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">self</span></div>



<div class="viewcode-block" id="FrozenConfiguration">
<a class="viewcode-back" href="../../generated/upsilonconf.FrozenConfiguration.html#upsilonconf.FrozenConfiguration">[docs]</a>
<span class="k">class</span> <span class="nc">FrozenConfiguration</span><span class="p">(</span><span class="n">ConfigurationBase</span><span class="p">[</span><span class="n">Hashable</span><span class="p">],</span> <span class="n">Hashable</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Immutable configuration.</span>

<span class="sd">    `FrozenConfiguration` is an immutable `ConfigurationBase` implementation.</span>
<span class="sd">    This means that values can **not** be added, changed and/or deleted.</span>
<span class="sd">    As a result, `FrozenConfiguration` is a `Hashable` type,</span>
<span class="sd">    which means that they can be used in a ``set``</span>
<span class="sd">    or serve as keys in a ``dict``.</span>

<span class="sd">    .. versionadded:: 0.7.0</span>

<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    ConfigurationBase : the configuration interface.</span>
<span class="sd">    PlainConfiguration : a mutable configuration.</span>

<span class="sd">    Warnings</span>
<span class="sd">    --------</span>
<span class="sd">    In the current implementation, using method names as keys is possible,</span>

<span class="sd">    &gt;&gt;&gt; conf = FrozenConfiguration()</span>
<span class="sd">    &gt;&gt;&gt; print(conf.items)</span>
<span class="sd">    &lt;bound method ConfigurationBase.items of FrozenConfiguration()&gt;</span>
<span class="sd">    &gt;&gt;&gt; conf = FrozenConfiguration(items=123)</span>
<span class="sd">    &gt;&gt;&gt; print(conf.items)</span>
<span class="sd">    123</span>

<span class="sd">    but it can lead to some unexpected behaviour.</span>

<span class="sd">    &gt;&gt;&gt; print(conf)</span>
<span class="sd">    {items: 123}</span>
<span class="sd">    &gt;&gt;&gt; conf == {&quot;items&quot;: 123}</span>
<span class="sd">    Traceback (most recent call last):</span>
<span class="sd">        ...</span>
<span class="sd">    TypeError: &#39;int&#39; object is not callable</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    Starting with a simple configuration.</span>

<span class="sd">    &gt;&gt;&gt; conf = FrozenConfiguration(foo=0, bar=&quot;bar&quot;, baz={&#39;a&#39;: 1, &#39;b&#39;: 2})</span>
<span class="sd">    &gt;&gt;&gt; print(conf)</span>
<span class="sd">    {foo: 0, bar: bar, baz: {a: 1, b: 2}}</span>

<span class="sd">    Attempts to change the configuration will result in errors.</span>

<span class="sd">    &gt;&gt;&gt; conf.surprise = None</span>
<span class="sd">    Traceback (most recent call last):</span>
<span class="sd">        ...</span>
<span class="sd">    AttributeError: &#39;FrozenConfiguration&#39; object has no attribute &#39;surprise&#39;</span>
<span class="sd">    &gt;&gt;&gt; conf[&quot;surprise&quot;] = []</span>
<span class="sd">    Traceback (most recent call last):</span>
<span class="sd">        ...</span>
<span class="sd">    TypeError: &#39;FrozenConfiguration&#39; object does not support item assignment</span>
<span class="sd">    &gt;&gt;&gt; del conf.baz.a</span>
<span class="sd">    Traceback (most recent call last):</span>
<span class="sd">        ...</span>
<span class="sd">    AttributeError: &#39;FrozenConfiguration&#39; object attribute &#39;a&#39; is read-only</span>

<span class="sd">    Values should be of hashable types,</span>
<span class="sd">    but non-hashable types are converted if possible.</span>

<span class="sd">    &gt;&gt;&gt; print(FrozenConfiguration(value=[1, 2, 3]))</span>
<span class="sd">    {value: (1, 2, 3)}</span>
<span class="sd">    &gt;&gt;&gt; print(FrozenConfiguration(value=slice(None)))</span>
<span class="sd">    Traceback (most recent call last):</span>
<span class="sd">        ...</span>
<span class="sd">    TypeError: unhashable type: &#39;slice&#39;</span>

<span class="sd">    Frozen configurations can be used keys in a ``dict``.</span>

<span class="sd">    &gt;&gt;&gt; results = {</span>
<span class="sd">    ...     FrozenConfiguration(option=1): 0.1,</span>
<span class="sd">    ...     FrozenConfiguration(option=2): 0.9,</span>
<span class="sd">    ... }</span>
<span class="sd">    &gt;&gt;&gt; print(max(results.items(), key=lambda kv: kv[1]))</span>
<span class="sd">    (FrozenConfiguration(option=2), 0.9)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Hashable</span><span class="p">,</span> <span class="n">Collection</span><span class="p">,</span> <span class="n">Mapping</span><span class="p">]):</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">conf</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">unresolved</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_resolve_key</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
            <span class="n">conf</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fix_value</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">unresolved</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__hash__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="c1"># inspired by https://stackoverflow.com/questions/20832279</span>
        <span class="n">h</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">hx</span> <span class="o">=</span> <span class="nb">hash</span><span class="p">((</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">))</span>
            <span class="n">h</span> <span class="o">^=</span> <span class="p">(</span><span class="n">hx</span> <span class="o">^</span> <span class="mh">0x156B45B3</span> <span class="o">^</span> <span class="p">(</span><span class="n">hx</span> <span class="o">&lt;&lt;</span> <span class="mi">16</span><span class="p">))</span> <span class="o">*</span> <span class="mi">4_155_791_671</span>  <span class="c1"># randomise</span>
            <span class="n">h</span> <span class="o">&amp;=</span> <span class="mh">0xFFFF_FFFF_FFFF_FFFF</span>  <span class="c1"># limit to 8 bytes</span>

        <span class="k">return</span> <span class="n">h</span>

    <span class="c1"># # # Attribute Access # # #</span>

    <span class="k">def</span> <span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">_</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>  <span class="c1"># recycle errors from getattr</span>
        <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&#39; object attribute &#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39; is read-only&quot;</span>
        <span class="p">)</span>

    <span class="fm">__delattr__</span> <span class="o">=</span> <span class="fm">__setattr__</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_fix_value</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">wrappers</span><span class="o">=</span><span class="p">(),</span> <span class="n">old_val</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">_make_hashable</span><span class="p">(</span><span class="n">o</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="n">Hashable</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">o</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="n">Mapping</span><span class="p">):</span>
                <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="o">**</span><span class="n">o</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="n">Collection</span><span class="p">):</span>
                <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">_make_hashable</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">o</span><span class="p">)</span>

            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;unhashable type: &#39;</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">o</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_fix_value</span><span class="p">(</span><span class="n">_make_hashable</span><span class="p">(</span><span class="n">value</span><span class="p">),</span> <span class="n">wrappers</span><span class="p">,</span> <span class="n">old_val</span><span class="p">)</span></div>



<div class="viewcode-block" id="CarefulConfiguration">
<a class="viewcode-back" href="../../generated/upsilonconf.CarefulConfiguration.html#upsilonconf.CarefulConfiguration">[docs]</a>
<span class="k">class</span> <span class="nc">CarefulConfiguration</span><span class="p">(</span><span class="n">PlainConfiguration</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Configuration with overwrite protection.</span>

<span class="sd">    A `Configuration` should provide a convenient way to store</span>
<span class="sd">    (hyper-)parameters for your code and/or experiments.</span>
<span class="sd">    Any configuration value that represents a mapping is also automagically</span>
<span class="sd">    converted to a `Configuration` to build arbitrary config hierarchies.</span>

<span class="sd">    Additional parameter values can be added to the mapping as needed.</span>
<span class="sd">    However, to avoid unwanted changes to configuration values,</span>
<span class="sd">    it is not possible to directly set the value for existing parameters.</span>
<span class="sd">    If you deliberately wish to set the value for existing parameters,</span>
<span class="sd">    you should use the `overwrite` method instead.</span>

<span class="sd">    Methods</span>
<span class="sd">    -------</span>
<span class="sd">    overwrite(key, value)</span>
<span class="sd">        Explicitly overwrite an existing parameter value in the configuration.</span>
<span class="sd">    overwrite_all(m, **kwargs)</span>
<span class="sd">        Explicitly overwrite multiple existing parameter values in the configuration.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; conf = CarefulConfiguration(foo=0, bar=&quot;bar&quot;, baz={&#39;a&#39;: 1, &#39;b&#39;: 2})</span>
<span class="sd">    &gt;&gt;&gt; print(conf)</span>
<span class="sd">    {foo: 0, bar: bar, baz: {a: 1, b: 2}}</span>
<span class="sd">    &gt;&gt;&gt; conf[&#39;bar&#39;]</span>
<span class="sd">    &#39;bar&#39;</span>
<span class="sd">    &gt;&gt;&gt; conf[&#39;baz&#39;][&#39;a&#39;]</span>
<span class="sd">    1</span>

<span class="sd">    Values can also be accessed as attributes, tuples or a string with dots</span>

<span class="sd">    &gt;&gt;&gt; conf.bar</span>
<span class="sd">    &#39;bar&#39;</span>
<span class="sd">    &gt;&gt;&gt; conf.baz.a</span>
<span class="sd">    1</span>
<span class="sd">    &gt;&gt;&gt; conf[&#39;baz&#39;, &#39;a&#39;]</span>
<span class="sd">    1</span>
<span class="sd">    &gt;&gt;&gt; conf[&#39;baz.a&#39;]</span>
<span class="sd">    1</span>

<span class="sd">    Values for new parameters can be added directly.</span>
<span class="sd">    To avoid inadvertadly overwriting values, the `overwrite` method must be used.</span>

<span class="sd">    &gt;&gt;&gt; conf.new = &quot;works&quot;</span>
<span class="sd">    &gt;&gt;&gt; conf[&#39;new&#39;] = &quot;won&#39;t work&quot;</span>
<span class="sd">    Traceback (most recent call last):</span>
<span class="sd">        ...</span>
<span class="sd">    ValueError: key &#39;new&#39; already defined, use &#39;overwrite&#39; methods instead</span>
<span class="sd">    &gt;&gt;&gt; conf.overwrite(&#39;new&#39;, &quot;will work&quot;)</span>
<span class="sd">    &#39;works&#39;</span>
<span class="sd">    &gt;&gt;&gt; conf.new</span>
<span class="sd">    &#39;will work&#39;</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="n">root</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">unresolved</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_resolve_key</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">root</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;key &#39;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">&#39; already defined, use &#39;overwrite&#39; methods instead&quot;</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="n">root</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fix_value</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">unresolved</span><span class="p">)</span>

    <span class="c1"># # # Merging # # #</span>

    <span class="k">def</span> <span class="fm">__or__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">|=</span> <span class="n">other</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="c1"># # # Attribute Access # # #</span>

    <span class="k">def</span> <span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">except</span> <span class="n">InvalidKeyError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;can&#39;t set attribute &#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span> <span class="kn">from</span> <span class="kc">None</span>
        <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span> <span class="kn">from</span> <span class="kc">None</span>

    <span class="c1"># # # Key Magic # # #</span>

    <span class="k">def</span> <span class="nf">_resolve_key</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">keys</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="s2">&quot;CarefulConfiguration&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="o">...</span><span class="p">]]:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">keys</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">keys</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">keys</span><span class="p">)</span>

        <span class="n">root</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">unresolved</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_resolve_key</span><span class="p">(</span><span class="n">keys</span><span class="p">)</span>
        <span class="n">root</span><span class="o">.</span><span class="n">_validate_key</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">root</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">unresolved</span>

    <span class="k">def</span> <span class="nf">_validate_key</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check if a key respects a set of simple rules.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        InvalidKeyError</span>
<span class="sd">            If the key does not respect the rules.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">key</span><span class="o">.</span><span class="n">isidentifier</span><span class="p">()</span> <span class="ow">or</span> <span class="n">keyword</span><span class="o">.</span><span class="n">iskeyword</span><span class="p">(</span><span class="n">key</span><span class="p">):</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;key </span><span class="si">{</span><span class="n">key</span><span class="si">!r}</span><span class="s2"> will not be accessible using attribute syntax&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">key</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">isalpha</span><span class="p">():</span>
            <span class="c1"># TODO: should hidden attributes be allowed (as keys)?</span>
            <span class="k">raise</span> <span class="n">InvalidKeyError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">key</span><span class="si">!r}</span><span class="s2"> does not start with a letter&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">):</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;using key </span><span class="si">{</span><span class="n">key</span><span class="si">!r}</span><span class="s2"> would break the interface of this object&quot;</span>
            <span class="k">raise</span> <span class="n">InvalidKeyError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="k">return</span> <span class="kc">True</span>

    <span class="c1"># # # Overwriting # # #</span>

<div class="viewcode-block" id="CarefulConfiguration.overwrite">
<a class="viewcode-back" href="../../generated/upsilonconf.CarefulConfiguration.html#upsilonconf.CarefulConfiguration.overwrite">[docs]</a>
    <span class="k">def</span> <span class="nf">overwrite</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Overwrite a possibly existing parameter value in the configuration.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        key : str</span>
<span class="sd">            The parameter name to overwrite the value for.</span>
<span class="sd">        value</span>
<span class="sd">            The new value for the parameter.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        old_value</span>
<span class="sd">            The value that has been overwritten</span>
<span class="sd">            or ``None`` if no value was present.</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        overwrite_all : overwrite multiple values in one go.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">key</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>

        <span class="n">conf</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">unresolved</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_resolve_key</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fix_value</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">unresolved</span><span class="p">)</span>
        <span class="n">old_value</span> <span class="o">=</span> <span class="n">conf</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">sub_conf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="o">**</span><span class="n">old_value</span><span class="p">)</span>
            <span class="n">old_value</span> <span class="o">=</span> <span class="n">sub_conf</span><span class="o">.</span><span class="n">overwrite_all</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">sub_conf</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="n">conf</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">return</span> <span class="n">old_value</span></div>


<div class="viewcode-block" id="CarefulConfiguration.overwrite_all">
<a class="viewcode-back" href="../../generated/upsilonconf.CarefulConfiguration.html#upsilonconf.CarefulConfiguration.overwrite_all">[docs]</a>
    <span class="k">def</span> <span class="nf">overwrite_all</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">_MappingLike</span> <span class="o">=</span> <span class="p">(),</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Overwrite multiple possibly existing parameter value in this configuration.</span>

<span class="sd">        This method makes it possible to overwrite multiple values in one go.</span>
<span class="sd">        It should produce the same results as calling `update`</span>
<span class="sd">        when none of the keys are already contained in this configuration.</span>
<span class="sd">        Unlike `update`, however, this method will not raise an error</span>
<span class="sd">        if one or more of the keys already exist.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        other : Mapping or iterable of tuples</span>
<span class="sd">            Dictionary-like object with values to overwrite.</span>
<span class="sd">        **kwargs</span>
<span class="sd">            Additional key-value pairs for overwrites.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        old_values : Mapping</span>
<span class="sd">            Mapping from keys to the values that have been overwritten.</span>
<span class="sd">            If the key did not exist, the corresponding value is ``None``.</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        overwrite : overwrite single values.</span>
<span class="sd">        update : same functionality, but raises errors for duplicate keys.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">old_values</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Mapping</span><span class="p">):</span>
            <span class="n">other</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">other</span><span class="p">:</span>
            <span class="n">old_values</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">overwrite</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">old_values</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">overwrite</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">old_values</span></div>
</div>



<span class="c1"># utilities</span>


<span class="k">def</span> <span class="nf">_modify_keys</span><span class="p">(</span>
    <span class="n">key_value_pairs</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span> <span class="n">key_mods</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Replace strings in the keys of a mapping object recursively.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    key_value_pairs : Mapping</span>
<span class="sd">        The mapping object whose keys are to be modified.</span>
<span class="sd">    key_mods : Mapping</span>
<span class="sd">        The dictionary with the replacements: All key strings are replaced</span>
<span class="sd">        with the corresponding values from this dictionary.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    dict</span>
<span class="sd">        A dictionary with the modified keys.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># See https://github.com/hoedt/upsilonconf/pull/6 for alternative</span>
    <span class="c1"># implementations (and a discussion about them) which do not use regular</span>
    <span class="c1"># expressions.</span>

    <span class="c1"># Build and compile replacement pattern</span>
    <span class="n">sorted_mod_keys</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">key_mods</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">k</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">re</span><span class="o">.</span><span class="n">escape</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">sorted_mod_keys</span><span class="p">]))</span>

    <span class="k">return</span> <span class="n">__modify_keys</span><span class="p">(</span><span class="n">key_value_pairs</span><span class="p">,</span> <span class="n">key_mods</span><span class="p">,</span> <span class="n">pattern</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">__modify_keys</span><span class="p">(</span>
    <span class="n">key_value_pairs</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span>
    <span class="n">key_mods</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
    <span class="n">pattern</span><span class="p">:</span> <span class="n">Pattern</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Replace strings in the keys of a mapping object.</span>

<span class="sd">    This is the working horse for `_modify_keys` to do the replacement</span>
<span class="sd">    recursively.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    key_value_pairs : Mapping</span>
<span class="sd">        The mapping object whose keys are to be modified.</span>
<span class="sd">    key_mods : Mapping</span>
<span class="sd">        The dictionary with the replacements: All key strings are replaced</span>
<span class="sd">        with the corresponding values from this dictionary.</span>
<span class="sd">    pattern : Pattern</span>
<span class="sd">        The compiled replacement pattern.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    dict</span>
<span class="sd">        A dictionary with the modified keys.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">dictionary</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1"># `mapping.items()` fails with `AttributeError`, if `mapping` is not of a</span>
    <span class="c1"># mapping type, thus breaking the recursive calls</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">key_value_pairs</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Call this method recursively</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">__modify_keys</span><span class="p">(</span><span class="n">value</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">key_mods</span><span class="p">,</span> <span class="n">pattern</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="c1"># `value` is not of the mapping type</span>
            <span class="k">pass</span>

        <span class="c1"># Replace only, if there are replacements requested, otherwise just</span>
        <span class="c1"># save the value</span>
        <span class="k">if</span> <span class="n">key_mods</span><span class="p">:</span>
            <span class="n">key</span> <span class="o">=</span> <span class="n">pattern</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="k">lambda</span> <span class="n">m</span><span class="p">:</span> <span class="n">key_mods</span><span class="p">[</span><span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">0</span><span class="p">)],</span> <span class="n">key</span><span class="p">)</span>

        <span class="n">dictionary</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

    <span class="k">return</span> <span class="n">dictionary</span>


<span class="k">class</span> <span class="nc">Configuration</span><span class="p">(</span><span class="n">CarefulConfiguration</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Temporary alias for CarefulConfiguration.</span>

<span class="sd">    .. deprecated:: 0.7.0</span>
<span class="sd">        Configuration has been renamed to CarefulConfiguration</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
            <span class="s2">&quot;Configuration has been renamed to CarefulConfiguration&quot;</span><span class="p">,</span>
            <span class="ne">DeprecationWarning</span><span class="p">,</span>
            <span class="n">stacklevel</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../index.html">UpsilonConf</a></h1>









<search id="searchbox" style="display: none" role="search">
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" placeholder="Search"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script><h3>Navigation</h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../usage.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../about.html">Fun Facts</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../index.html">Documentation overview</a><ul>
  <li><a href="../index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2022-2024, Pieter-Jan Hoedt.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 8.0.2</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 1.0.0</a>
      
    </div>

    

    
  </body>
</html>